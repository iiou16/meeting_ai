# 実装TODOリスト

> 各ステップの実装時には必ずユニットテストを作成・更新し、既存機能への影響を確認すること。

## フェーズ0: 準備

- [ ] OpenAI APIキー・利用制限の確認、環境変数定義 (`OPENAI_API_KEY` 等)。
- [x] FFmpegのセットアップ (ローカル開発用バイナリ確認、Dockerイメージに追加)。
- [x] フロントエンド雛形作成（`frontend/` 配下で Next.js + TypeScript + ESLint/Prettier）。
- [x] バックエンド雛形作成（`backend/` 配下で FastAPI プロジェクト、`uv` による仮想環境/依存管理）。
- [ ] インフラ・データベース接続設定（PostgreSQL/RedisのDocker Compose定義、サービス間通信のネットワーク設計）。

## フェーズ1: バックエンド基盤

- [x] 動画アップロードAPI (`POST /api/videos`) の実装（FastAPI、multipart対応、S3互換ストレージ保存）。
- [x] `uv` スクリプトでバックエンドの起動/テストコマンドを整備。
- [x] ジョブキュー設定（Redis + RQ/CeleryなどPython向けキュー）とワーカーの雛形作成。
- [x] 動画→音声抽出処理（FFmpeg呼び出し）をワーカーで実装。
- [x] 音声チャンク分割とメタデータ管理（`MediaAsset` レコード作成）。
- [x] GPT-4o Transcribe API呼び出し実装（チャンクごとの再試行、レート制御）。
- [x] 文字起こし結果のマージと`TranscriptSegment`への保存。
  - [x] マージユーティリティと永続化ヘルパーの実装。
  - [x] ワーカー処理へ組み込み、生成物を`TranscriptSegment`として保存。

## フェーズ1.5: 音声ファイル直接入力対応

> 対応形式: MP3, WAV, M4A, AAC, FLAC, OGG
> 方針: 音声ファイルは動画→音声抽出をスキップし、FFmpegによるWAV統一変換（モノラル・16kHz・PCM 16-bit）のみ実行。チャンク分割以降の処理は既存のまま。

### ステップ1: テスト作成（TDD）
- [ ] 音声ファイル入力のユニットテスト作成（失敗を確認）。
  - MP3/M4A/WAVファイルのアップロード受付テスト。
  - サポート外形式（`.wma` 等）の拒否テスト。
  - 破損した音声ファイルのエラーハンドリングテスト。
  - 極短音声（5秒以下）の処理テスト。
- [ ] ingestタスクの音声ファイル判定・変換ユニットテスト作成（失敗を確認）。

### ステップ2: バックエンド実装
- [ ] アップロードAPIのMIMEタイプバリデーションに `audio/*` を許可。
- [ ] ingestタスクに音声ファイル判定ロジックを追加（拡張子ベース）。音声ファイルの場合はFFmpegによるWAV統一変換のみ実行。
- [ ] ジョブ進捗計算で音声ファイル拡張子（`.mp3`, `.wav`, `.m4a` 等）を考慮。
- [ ] フロントエンドのジョブステータス表示文言を汎用化（「動画処理中」→「メディア処理中」等）。

### ステップ3: フロントエンド実装
- [ ] ファイル選択制限に音声形式を追加（`accept`属性に `audio/mpeg,audio/wav,audio/x-m4a` 等を追加）。

### ステップ4: テスト実行・検証
- [ ] ステップ1で作成したテストがすべてパスすることを確認。
- [ ] 既存の動画アップロードテストが引き続きパスすることを確認（リグレッション）。

## フェーズ2: 要約・データ整形

- [x] 文字起こしから要約プロンプトを生成するロジック設計（Pythonサービスとして実装）。
- [x] GPT-4oによるタイムスタンプ付き要約実装（セクション分割と`SummaryItem`保存）。
- [x] アクションアイテム抽出プロンプトとデータモデルへの保存。
- [x] 要約/アクションアイテムの品質評価指標定義（テストデータで検証）。

## フェーズ3: フロントエンド

- [x] アップロード画面（プログレス表示、サイズ検証）。
- [x] バックエンドAPIクライアント実装（OpenAPIコード生成または手動型定義共有）。
- [x] ジョブ進捗ダッシュボード（Polling or WebSocket）。
- [x] 議事録閲覧画面（全文文字起こし、タイムスタンプリンク、検索フィルタ）。
- [x] 要約ハイライト表示、アクションアイテムリスト、エクスポートボタン。
- [x] UIアクセシビリティチェック、i18n対応（日本語/英語）。

## フェーズ4: エクスポート・通知

- [ ] JSON/Markdown/CSV出力エンドポイントの実装とUI連携。
- [ ] メール/Slack通知連携で処理完了通知を送信。
- [ ] データ削除API (`DELETE /api/meetings/{id}`) とUI。
- [ ] ライフサイクル管理（保存期限経過データの自動削除ジョブ）。

## フェーズ5: 運用・品質

- [ ] ロギング・モニタリング (OpenTelemetry + Grafana/Papertrail等)。
- [ ] エラー検知・再試行ポリシーの実装とテスト。
- [ ] E2Eテスト（Cypress/Playwright）と負荷テストシナリオ作成。
- [ ] セキュリティレビュー（API認証、RBAC、データ暗号化）。
- [ ] ドキュメント整備（開発手順書、運用Runbook）。

## オープンクエスチョン

- [ ] 話者識別(ダイアライゼーション)をどこまで行うか。
- [ ] 要約品質評価に人手レビューを組み込むか。
- [ ] 料金プランやユーザー課金設計の要否。
- [ ] 外部連携（Google Drive, Zoom, Teams録画）の優先度。
